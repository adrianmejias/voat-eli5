var pages=[],links=[],loading=!1,shorten=30,no_more=!1,stickied=!1,duplicates=[],columns=2;if($("body").css("font-family","'Open Sans', sans-serif"),$("#header-account").hide(),$(".side").hide(),$(".tabmenu").append($("<li>").addClass("disabled").append($("<a>").addClass("toggle-side").attr("href","#").text("Show Side").click(function(){$(".side").toggle(),$(".side").is(":hidden")?($(this).text("Show Side"),$(".sitetable .submission[data-fullname]").removeClass("col-1").addClass("col-"+columns),columns>1&&$(".sitetable .submission[data-fullname]").eqh()):($(this).text("Hide Side"),$(".sitetable .submission[data-fullname]").removeClass("col-"+columns).addClass("col-1"))}))).append($("<li>").addClass("disabled").append($("<a>").addClass("toggle-votes").attr("href","#").text("Show Votes").click(function(){$(".midcol.unvoted, .scorebar").toggle(),$(".midcol.unvoted").is(":hidden")?$(this).text("Show Votes"):$(this).text("Hide Votes")}))).append($("<li>").addClass("disabled").append($("<a>").addClass("toggle-account").attr("href","#").text("Show Account").click(function(){$("#header-account").toggle(),$("#header-account").is(":hidden")?$(this).text("Show Account"):$(this).text("Hide Account")}))),$(".pagination-container").length){$(".pagination-container").hide(),$(".sitetable").after($("<div>").addClass("pagination-container").append($("<ul>").append($("<li>").addClass("btn-whoaverse-paging more").append($("<a>").attr("href","#").text("Scroll to load more...")).hide()).append($("<li>").addClass("btn-whoaverse-paging load-more").append($("<a>").attr("href","#").text("Loading more...")).hide()).append($("<li>").addClass("btn-whoaverse-paging no-more").append($("<a>").attr("href","#").text("No more pages to load.")).hide()))),$('a[href="/random"]').remove(),$("body").prepend($("<div>").attr("id","link-overlay").addClass("link-overlay").hide().click(function(a){a.preventDefault(),$(this).hide(),$("#expando-item").remove()}));var formatSubmission=function(){var a=$(this).data("fullname")||-1;if(-1==a)return stickied&&$(this).hide(),stickied=!0,void 0;if(-1==$.inArray(a,links)){links.push(a),$(this).addClass("col col-"+columns);var b=$(this).find(".flat-list.buttons .first a"),c=$(this).find("p.title a.title"),d=c.text();d.length>shorten+3&&(trimmedString=d.substring(0,shorten),trimmedString=trimmedString.substr(0,Math.min(trimmedString.length,trimmedString.lastIndexOf(" "))),c.text(trimmedString+" ..")),$(this).find(".scorebar").addClass("no-scorebar"),$(this).find(".midcol.unvoted, .scorebar").hide(),b.attr("href")!=c.attr("href")&&$(this).find(".flat-list.buttons .first").after($("<li>").append($("<a>").attr({href:c.attr("href"),target:"_blank"}).addClass("option main active").text("open link and "+("discuss"==b.text()?"discuss":"comments")).click(function(){window.open(b.attr("href"),"_blank")}))),$(this),$(this).find(".expando-button").hide();var f=$(this).find(".thumbnail").css("border","none"),g=$(this).find("p.title a.title"),h=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i;g.length>0&&g.attr("href").match(/veuwer\.com\/i\/([a-zA-Z0-9]+)$/g)?(titleSrc=g.attr("href").replace("http:","https:")+".jpg",$(this).find(".clearleft").after($("<div>").addClass("embed-item").append($("<img>").attr("src",titleSrc).addClass("img-responsive").attr("data-featherlight",titleSrc))),f.length>0&&f.remove()):g.length>0&&g.attr("href").match(/(.+)\.(jpe|jpe?g|gif|png)$/g)&&!g.attr("href").match(/slimimgur\.com/g)?(titleSrc=g.attr("href").match(/imgur\.com/g)&&!g.attr("href").match(/slimimgur\.com/g)?g.attr("href").replace("http:","https:"):g.attr("href"),$(this).find(".clearleft").after($("<div>").addClass("embed-item").append($("<img>").attr("src",titleSrc).addClass("img-responsive").attr("data-featherlight",titleSrc))),f.length>0&&f.remove()):g.length>0&&g.attr("href").match(/(.+)\.(gifv|webm)$/g)&&!g.attr("href").match(/slimimgur\.com/g)?(titleSrc=g.attr("href").match(/imgur\.com/g)?g.attr("href").replace("http:","https:"):g.attr("href"),$(this).find(".clearleft").after($("<div>").addClass("embed-responsive embed-responsive-4by3 embed-item").append($("<iframe>").addClass("embed-responsive-item").attr({src:titleSrc}))),f.remove()):g.length>0&&g.attr("href").match(h)?(titleSrc=g.attr("href").replace("http:","https:"),yid=g.attr("href").match(h)[1],$(this).find(".clearleft").after($("<div>").addClass("embed-responsive embed-responsive-4by3 embed-item").append($("<iframe>").addClass("embed-responsive-item").attr({src:"https://www.youtube.com/embed/"+yid}))),f.remove()):g.length>0&&(g.text(g.attr("title")).addClass("article-title"),f.remove())}else $(this).hide(),duplicates.push(a),console.log("duplicate",a)};$(".sitetable .submission").each(formatSubmission),$(".sitetable").addClass("verse"),$("[data-fullname]").eqh(),$(window).scroll(function(){if(no_more)return $(".load-more").hide(),$(".no-more").show(),void 0;if(!loading&&($(window).scrollTop()+$(window).height()>$(document).height()-200&&$(".more").show(),$(window).scrollTop()+$(window).height()==$(document).height())){$(".more").hide(),$(".no-more").hide(),console.log("load next page");var b=$(".pagination-container [rel=next]").attr("href"),c=b.replace(/\/v\/([^\?]+)\?/g,"").replace("page=","").replace("/?","");console.log("check for next page"),b.length>0?(console.log("next",b,$.inArray(b,pages)),-1==$.inArray(b,pages)&&(loading=!0,console.log("get next page",b),$(".load-more").show(),$.get(b,function(a){if(a){pages.push(b);var d=$("<div>").html(a.replace(/<script(.|\s)*?\/script>/g,"")),e=d.find(".sitetable .submission"),f=d.find(".pagination-container [rel=next]").attr("href");f?f.replace(/\/v\/([^\?]+)\?/g,"").replace("page=",""):-1,e.length>0&&(console.log("check for duplicates"),duplicates=[],$(e).each(formatSubmission),f?(console.log("next page",f),$(".pagination-container [rel=next]").attr("href",f),console.log("submissions",e.length,"duplicates",duplicates.length,duplicates),$(".sitetable").append(e.attr("data-page",c)),console.log("hash",c),$(window.location).attr("hash","page-"+c)):(console.log("no more"),no_more=!0))}},"html").done(function(){columns>1&&$(".sitetable .submission[data-fullname]").eqh()}).fail(function(){}).always(function(){console.log("loaded more"),$(".load-more").hide(),loading=!1}))):$(".no-more").show()}})}